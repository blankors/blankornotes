<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第4章 库存 (Inventory) | blankor的笔记</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="blankor notes">
    
    <link rel="preload" href="/blankornotes/assets/css/0.styles.372fc7a5.css" as="style"><link rel="preload" href="/blankornotes/assets/js/app.9dfec706.js" as="script"><link rel="preload" href="/blankornotes/assets/js/2.a76d4e78.js" as="script"><link rel="preload" href="/blankornotes/assets/js/1.2ec8c7d7.js" as="script"><link rel="preload" href="/blankornotes/assets/js/27.181728ca.js" as="script"><link rel="prefetch" href="/blankornotes/assets/js/10.4c178469.js"><link rel="prefetch" href="/blankornotes/assets/js/11.31060eb5.js"><link rel="prefetch" href="/blankornotes/assets/js/12.279f272d.js"><link rel="prefetch" href="/blankornotes/assets/js/13.10227dfa.js"><link rel="prefetch" href="/blankornotes/assets/js/14.fe714d02.js"><link rel="prefetch" href="/blankornotes/assets/js/15.f53ca535.js"><link rel="prefetch" href="/blankornotes/assets/js/16.d3d5bdeb.js"><link rel="prefetch" href="/blankornotes/assets/js/17.4ef2ea13.js"><link rel="prefetch" href="/blankornotes/assets/js/18.37f5f491.js"><link rel="prefetch" href="/blankornotes/assets/js/19.b774cdca.js"><link rel="prefetch" href="/blankornotes/assets/js/20.5d9c4a68.js"><link rel="prefetch" href="/blankornotes/assets/js/21.47844c93.js"><link rel="prefetch" href="/blankornotes/assets/js/22.c16db6c7.js"><link rel="prefetch" href="/blankornotes/assets/js/23.2b33cfe8.js"><link rel="prefetch" href="/blankornotes/assets/js/24.c535894e.js"><link rel="prefetch" href="/blankornotes/assets/js/25.8bfe4653.js"><link rel="prefetch" href="/blankornotes/assets/js/26.ec30817f.js"><link rel="prefetch" href="/blankornotes/assets/js/28.83df3f07.js"><link rel="prefetch" href="/blankornotes/assets/js/29.813a5cfc.js"><link rel="prefetch" href="/blankornotes/assets/js/3.fb6a4e15.js"><link rel="prefetch" href="/blankornotes/assets/js/30.65a7c6f2.js"><link rel="prefetch" href="/blankornotes/assets/js/4.e9f08a68.js"><link rel="prefetch" href="/blankornotes/assets/js/5.3ffe72e2.js"><link rel="prefetch" href="/blankornotes/assets/js/6.8910dfd2.js"><link rel="prefetch" href="/blankornotes/assets/js/7.d094995e.js"><link rel="prefetch" href="/blankornotes/assets/js/vendors~docsearch.06f5d163.js">
    <link rel="stylesheet" href="/blankornotes/assets/css/0.styles.372fc7a5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blankornotes/" class="home-link router-link-active"><!----> <span class="site-name">blankor的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blankornotes/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blankornotes/datawarehouse/" class="nav-link router-link-active">
  数据仓库
</a></div><div class="nav-item"><a href="/blankornotes/python/" class="nav-link">
  Python
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="blankor的博客" class="dropdown-title"><span class="title">blankor的博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="blankor的博客" class="mobile-dropdown-title"><span class="title">blankor的博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012928365" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blankornotes/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/blankornotes/datawarehouse/" class="nav-link router-link-active">
  数据仓库
</a></div><div class="nav-item"><a href="/blankornotes/python/" class="nav-link">
  Python
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="blankor的博客" class="dropdown-title"><span class="title">blankor的博客</span> <span class="arrow down"></span></button> <button type="button" aria-label="blankor的博客" class="mobile-dropdown-title"><span class="title">blankor的博客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://blog.csdn.net/u012928365" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CSDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blankornotes/datawarehouse/ch1.html" class="sidebar-link">第一章</a></li><li><a href="/blankornotes/datawarehouse/ch2.html" class="sidebar-link">第二章</a></li><li><a href="/blankornotes/datawarehouse/ch3.html" class="sidebar-link">第三章</a></li><li><a href="/blankornotes/datawarehouse/ch6.html" class="sidebar-link">第六章</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第4章-库存-inventory"><a href="#第4章-库存-inventory" class="header-anchor">#</a> 第4章 库存 (Inventory)</h1> <h2 id="_4-1-价值链介绍-value-chain-introduction"><a href="#_4-1-价值链介绍-value-chain-introduction" class="header-anchor">#</a> 4.1 价值链介绍 (Value Chain Introduction)</h2> <p>大多数组织都有一条由‘关键业务流程’构成的‘潜在价值链’。价值链确定了组织主要活动的自然、逻辑流程。例如，零售商向产品制造商发出采购订单。产品被送到零售商的仓库，在那里作为库存储存。然后再运送到单个商店，产品在商店里再次作为库存存放，直到消费者购买。图4-1展示了零售商价值链的这一部分。显然，从制造商直接发货到零售商店的产品会绕过仓储流程。</p> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">graph</span> TD<span class="token punctuation">;</span>
    A<span class="token text string">[制造商]</span> <span class="token arrow operator">--&gt;</span> B<span class="token text string">[发出采购订单]</span>
    B <span class="token arrow operator">--&gt;</span> C<span class="token text string">[仓库接收货物]</span>
    C <span class="token arrow operator">--&gt;</span> D<span class="token text string">[仓库产品库存]</span>
    D <span class="token arrow operator">--&gt;</span> E<span class="token text string">[商店接收货物]</span>
    E <span class="token arrow operator">--&gt;</span> F<span class="token text string">[商店产品库存]</span>
    F <span class="token arrow operator">--&gt;</span> G<span class="token text string">[零售销售]</span>
</code></pre></div><p>图4-1：零售商价值链的一部分</p> <p>运营源系统Operational source systems通常在价值链的每个步骤中生成事务或快照。大多数分析型数据仓库/商业智能（DW/BI）系统的<strong>主要目标</strong>是监控这些关键流程的绩效结果。由于每个流程在不同的时间间隔、以不同的粒度和维度生成独特的‘指标’，因此每个流程通常会生成一个或多个事实表。为此，价值链为企业DW/BI环境的整体数据架构提供了高层次的见解。我们将在本章后面的 “价值链集成” 部分进一步讨论这个话题。</p> <h2 id="_4-2-库存模型-inventory-models"><a href="#_4-2-库存模型-inventory-models" class="header-anchor">#</a> 4.2 库存模型 (Inventory Models)</h2> <p>与此同时，我们将讨论几种‘互补’的库存模型。第一种是库存定期快照模型，在该模型中，产品库存水平会在‘固定间隔’进行测量，并作为单独的行记录在事实表中。随着时间的推移，这些定期快照行在维度模型中呈现为一系列数据层，就像地质层代表了长时间内沉积物的积累一样。接下来，我们将讨论第二种库存模型，在产品进出仓库的过程中，每一个影响库存水平的交易都会被记录下来。最后，在第三种模型中，我们将描述库存累积快照模型，即每次产品交付时，都会在事实表中插入一行记录，然后随着产品在仓库中的流转，该行会被更新。每个模型都讲述了不同的情况。对于某些分析需求，可能同时需要两个甚至三个模型。</p> <h3 id="_4-2-1-库存周期快照-inventory-periodic-snapshot"><a href="#_4-2-1-库存周期快照-inventory-periodic-snapshot" class="header-anchor">#</a> 4.2.1 库存周期快照 (Inventory Periodic Snapshot)</h3> <p>让我们回到零售案例研究。优化商店的库存水平对连锁企业的盈利能力有着<strong>重大影响</strong>。确保在正确的时间、正确的商店有正确的产品，能最大程度减少缺货情况（产品在货架上无货可售），并降低整体库存持有成本。零售商希望按产品和商店分析每日库存水平。</p> <p>现在是时候再次运用四步维度设计流程了。1我们感兴趣的分析业务流程是零售商店库存的定期快照。2运营库存系统提供的最细粒度的细节是每个商店中每种产品的每日库存。3从这个粒度声明中可以直接得出维度：日期、产品和商店。对于定期快照事实表来说，这种情况经常发生，因为你无法在事务的背景下表达粒度，所以需要列出维度[^]。在这个案例研究中，在这个粒度下没有其他描述性维度。例如，促销维度通常与产品流动相关，比如产品订购、接收或销售时，但与库存无关。</p> <p>4最简单的库存视图只涉及一个事实：现有库存数量。这就产生了一个非常简洁的维度设计，如图4-2所示。</p> <p>本案例研究中的‘日期维度表’与第3章中为零售商店销售开发的表相同。‘产品’和‘商店维度’可能会添加对库存分析有用的其他属性。例如，</p> <ul><li>假设每个产品的最小再订购数量或存储要求是常量且离散的描述符，那么产品维度可以添加这些列[^]。</li> <li>如果某产品的最小再订购数量因商店而异，则不能将其作为产品维度属性。在商店维度中，你可能会添加属性来标识冷冻和冷藏存储面积。</li></ul> <p>即使是像图4-2这样简单的模式也非常有用。如果对许多地点的许多产品频繁测量库存水平，就可以获得许多有价值的见解。然而，这个定期快照事实表面临着第3章的销售交易事实表没有的<strong>严重挑战</strong>。</p> <ul><li>销售事实表的稀疏度比较合理，因为并非每个购物车都会购买每种产品。</li> <li>另一方面，库存会生成‘密集’的快照表。
<ul><li>由于零售商努力避免缺货情况，可能每天每个商店的每种产品在事实表中都有一行记录。在这种情况下，你需要将<u>缺货时数量为零的测量值</u>作为明确的行包含在内。</li> <li>对于一家在100家商店中库存有60,000种产品的杂货店零售商来说，每晚加载事实表时大约会插入600万行（60,000种产品×100家商店）。不过，由于每行宽度仅为14字节，每次加载事实表只会增加84MB的大小。</li> <li>虽然在这种情况下数据量是可管理的，但某些定期快照的密集度可能需要做出一些<strong>妥协</strong>。最明显的可能是随着时间推移减少快照频率。将最近60天的库存保持在每日粒度，然后对历史数据采用粒度较低的每周快照可能是可以接受的。这样，在3年期间，快照数量可以从1095个减少到总共208个；60个每日快照和148个每周快照应存储在两个单独的事实表中，因为它们的周期不同。</li></ul></li></ul> <p><strong>半加性事实</strong>
Semi-Additive Facts
我们在第3章中强调了事实可加性的重要性。在库存快照模式中，现有库存数量可以按产品或商店进行汇总，得出有效的总计。然而，库存水平在不同日期之间不可相加，因为它们代表的是某一时刻的水平或余额的快照。由于库存水平（以及所有形式的财务账户余额）<u>在某些维度上可加，但并非在所有维度上都可加</u>，我们将它们称为半加性事实。</p> <p>如果你考虑自己的支票账户余额，库存余额事实的半加性就更容易理解了。</p> <ul><li>假设周一你的账户中有50美元。周二，余额保持不变。周三，你又存入50美元，所以余额现在是100美元。直到周末，该账户没有进一步的活动。</li> <li>到了周五，你不能简单地把这一周的每日余额相加，然后宣称‘最终余额’是400美元（基于50 + 50 + 100 + 100 + 100）。</li> <li>跨日期合并账户余额和库存水平最有用的方法是取平均值（在这个支票账户的例子中，平均余额为80美元）。你可能很熟悉银行在每月账户对账单中提到的日均余额。</li></ul> <p>注意：<strong>所有</strong>记录静态水平的度量（库存水平、财务账户余额以及诸如室温之类的强度度量）本质上在日期维度以及可能的其他维度上是不可加的。在这些情况下，可以通过在时间段数量上取平均值来跨日期聚合度量。</p> <p>不幸的是，你<strong>不能</strong>使用SQL的AVG函数来计算随时间的平均值。该函数对查询收到的所有行取平均，而不仅仅是日期数量。例如，如果一个查询请求在七个日期内三个产品在四个商店中的平均库存（例如，某一地理区域内一个品牌在一周内的日均库存），SQL的AVG函数会将库存总和除以84（3个产品×4家商店×7个日期）。显然，正确的答案是将库存总和除以7，即每日时间段的数量。</p> <p>OLAP产品提供了在多维数据集中定义聚合规则的能力，因此，如果数据是通过OLAP多维数据集部署的，像余额这样的半加性度量就不那么成问题了。</p> <p><strong>增强型库存事实</strong></p> <p>Enhanced Inventory Facts</p> <p>定期库存快照事实表中的简单视图能让你看到<u>库存水平的时间序列</u>。对于大多数库存分析而言，<u>仅有现有库存数量是不够的</u>。现有库存数量需要与其他事实结合使用，以衡量库存周转速度，并得出其他有趣的指标，如库存周转率和库存可供天数。</p> <p>如果在每个事实行中添加已售数量（或者，对于仓库位置而言，等同于已发货数量），就可以计算库存周转率和库存可供天数。</p> <ul><li>对于每日库存快照，每日的‘库存周转率’计算方法是‘已售数量’除以‘现有库存数量’。在较长时间段（如一年）内，库存周转率是‘总已售数量’除以‘日均现有库存数量’。</li> <li>库存可供天数的计算方法类似。在一段时间内，库存可供天数是‘期末现有库存数量’除以‘平均每日已售数量’ 。</li></ul> <p>除了已售数量，库存分析师还对‘库存成本的扩展价值’extended value of the inventory at cost以及‘最新售价的价值’感兴趣。图4-3展示了经过补充后的初始定期快照。</p> <p>请注意，现有库存数量是半加性的，但‘增强型定期快照’enhanced periodic snapshot中的其他度量都是完全可加的。</p> <ul><li>已售数量已汇总到快照的每日粒度。</li> <li>估值列是扩展的、可加的金额。</li> <li>在一些定期快照库存模式中，存储期初余额、库存变化量（delta）以及期末余额是很有用的。在这种情况下，余额同样是半加性的，而变化量在所有维度上都是完全可加的。</li></ul> <p>定期快照是<strong>最常见</strong>的库存模式nventory schema.。我们将简要讨论另外两种互补的视角，它们与刚刚设计的库存快照相互补充。为了换个角度，我们不再以‘零售商店库存’为例来描述这些模型，而是沿着价值链向上，讨论‘仓库中的库存’。</p> <p>[^]:对于周期快照事实表而言，其特点是不能像事务事实表那样在事务的具体情境中去明确粒度（事务事实表的粒度可以基于每个事务来确定）。因为周期快照是在特定的时间间隔（如每日）对状态进行记录，不存在像事务那样一个个明确的行为事件来界定粒度，所以就需要通过列举出像日期、产品、商店这样的维度来确定表的粒度和分析的角度。也就是说，在这种情况下，通过列出这些维度来明确周期快照事实表所关注和记录数据的具体范围和细节程度 。</p> <p>[^]: 假设一家电子产品零售商在构建产品维度表。对于一款型号为XYZ - 123的智能手机，其最小再订购数量始终为50台，这是一个固定的值，不会因每次订购情况不同而改变，并且50这个数值是明确、离散的，不是一个范围，所以可以将“最小再订购数量”作为一个列添加到产品维度表中，该列对应XYZ - 123这款产品的单元格值为50。 再比如该智能手机的存储要求是每100台需要占用1立方米的仓库空间，这也是一个固定且离散的描述。那么“存储要求”也可作为一列添加到产品维度表中，针对XYZ - 123产品的该列单元格可以记录为“每100台占1立方米”。通过这样添加列，产品维度表得到了增强，能为库存分析提供更丰富的信息 。</p> <p>[^]: “extended value of the inventory at cost” 指的是按成本计算的库存扩展价值。结合选中内容可知。这里的 “extended value” 可理解为考虑了一定因素（如库存数量与成本的综合考量）后的扩展意义上的价值，而 “at cost” 明确了是从成本角度来计算该价值。</p> <h3 id="_4-2-2-库存事务-inventory-transactions"><a href="#_4-2-2-库存事务-inventory-transactions" class="header-anchor">#</a> 4.2.2 库存事务 (Inventory Transactions)</h3> <p>对库存业务流程进行建模的第二种方法是记录影响库存的每一笔事务。仓库中的库存事务可能包括以下内容：</p> <ul><li>接收产品。</li> <li>将产品放入检验暂存区。</li> <li>从检验暂存区释放产品。</li> <li>由于检验不合格将产品退回供应商。</li> <li>将产品放入货箱。</li> <li>从货箱中取出产品。</li> <li>包装产品以便发货。</li> <li>将产品发货给客户。</li> <li>从客户处接收产品。</li> <li>将客户退回的产品重新放入库存。</li> <li>从库存中移除产品。</li></ul> <p>每笔库存事务都会确定日期、产品、仓库、供应商、事务类型，并且在大多数情况下，会有一个代表‘事务对库存数量影响’的单一数量。假设事实表的粒度是每笔库存事务一行，那么生成的模式如图4-4所示。</p> <p>尽管事务事实表很简单，但它包含了反映单个库存操作的详细信息。事务事实表对于衡量特定事务类型的频率和时间安排<strong>很有用</strong>，可以回答粒度较粗的定期快照无法回答的问题。</p> <p>即便如此，将事务事实表作为<u>分析库存绩效的‘唯一’基础</u>并不实际。虽然从理论上讲，可以从已知的库存位置向前滚动所有可能的事务，以重建任意时刻的确切库存状况，但对于跨越日期、产品、仓库或供应商的广泛分析问题来说，这样做过于繁琐且不切实际。</p> <p>注意：要记住，事务并非生活的全部。某种形式的快照表能提供对流程更全面的累积视图，通常能与事务事实表相互补充。</p> <p>在结束对事务事实表的讨论之前，我们的示例假定，每一种对库存水平产生正面或负面影响的事务类型transaction type<a href="%E6%B3%A8%E9%87%8A">^4.2.2-1</a>都具有一致的维度，即：日期、产品、仓库、供应商和事务类型。我们认识到，在现实世界中，某些事务类型可能具有不同的维度。例如，货运商可能与仓库收货和发货事务相关联；客户信息则可能与发货和客户退货事务相关。如果事务的维度因事件而异，那么就<strong>应该</strong>设计一系列相关的事实表，而不是将所有的库存事务都记录在单个事实表中。</p> <p>注意：如果绩效度量具有不同的自然粒度或维度，它们很可能来自不同的流程，应该分别建模为不同的事实表。</p> <p>“transaction type”指的是事务类型，在数据仓库和商业智能分析的语境中，它用于区分不同种类的业务事务。结合前面文本内容，主要围绕库存管理的业务场景，事务类型就是那些会对库存水平产生正面或负面影响的不同业务操作类别。</p> <p>例如：</p> <ul><li><strong>仓库收货</strong>：这是一种事务类型，会使库存水平增加。当货物从供应商处运达仓库时，这就是一次仓库收货事务。它关联着日期（收货的时间）、产品（收到的具体货物）、仓库（货物存放的地点）、供应商（提供货物的一方）等维度信息。</li> <li><strong>发货</strong>：属于会使库存水平降低的事务类型。当把产品从仓库发送给客户时，就发生了发货事务。除了日期、产品、仓库这些常见维度外，可能还会关联客户信息和货运商信息等。</li> <li><strong>客户退货</strong>：同样会对库存水平产生正向影响，因为退回的产品会重新回到库存中。它也有其特定的相关维度，如客户信息、退货日期等。</li></ul> <p>不同的事务类型有不同的业务含义和处理逻辑，通过对事务类型进行区分和记录，可以更细致地分析库存的变化情况，为企业的库存管理和决策提供有力支持。</p> <h3 id="_4-2-3-库存累积快照-inventory-accumulating-snapshot"><a href="#_4-2-3-库存累积快照-inventory-accumulating-snapshot" class="header-anchor">#</a> 4.2.3 库存累积快照 (Inventory Accumulating Snapshot)</h3> <p>最后一种库存模型是累积快照。累积快照事实表<strong>用于</strong>具有明确开始、明确结束以及其间可识别的里程碑的流程。在这种库存模型中，当特定产品在仓库收到时，会在事实表中插入一行。在该产品离开仓库之前，会在这一事实行上跟踪其处置情况。在本示例中，<strong>只有</strong>当你能够可靠地区分不同批次收到的产品时，累积快照模型才可行；如果你通过产品序列号或批次号跟踪产品移动，这种模型也适用。</p> <p>现在假设一批产品在仓库中的库存水平记录了一系列明确的事件或里程碑，如收货、检验、货箱存放和发货。如图4-5所示，‘包含众多日期和事实的库存累积快照事实表’看起来与‘事务型’或‘定期快照模式’有很大不同。</p> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">erDiagram</span>
    DATE_RECEIVED_DIMENSION <span class="token arrow operator">||--o{</span> INVENTORY_RECEIPT_ACCUMULATING_FACT <span class="token operator">:</span> <span class="token string">&quot;关联&quot;</span>
    DATE_INSPECTED_DIMENSION <span class="token arrow operator">||--o{</span> INVENTORY_RECEIPT_ACCUMULATING_FACT <span class="token operator">:</span> <span class="token string">&quot;关联&quot;</span>
    DATE_BIN_PLACEMENT_DIMENSION <span class="token arrow operator">||--o{</span> INVENTORY_RECEIPT_ACCUMULATING_FACT <span class="token operator">:</span> <span class="token string">&quot;关联&quot;</span>
    DATE_INITIAL_SHIPMENT_DIMENSION <span class="token arrow operator">||--o{</span> INVENTORY_RECEIPT_ACCUMULATING_FACT <span class="token operator">:</span> <span class="token string">&quot;关联&quot;</span>
    DATE_LAST_SHIPMENT_DIMENSION <span class="token arrow operator">||--o{</span> INVENTORY_RECEIPT_ACCUMULATING_FACT <span class="token operator">:</span> <span class="token string">&quot;关联&quot;</span>
    PRODUCT_DIMENSION <span class="token arrow operator">||--o{</span> INVENTORY_RECEIPT_ACCUMULATING_FACT <span class="token operator">:</span> <span class="token string">&quot;关联&quot;</span>
    WAREHOUSE_DIMENSION <span class="token arrow operator">||--o{</span> INVENTORY_RECEIPT_ACCUMULATING_FACT <span class="token operator">:</span> <span class="token string">&quot;关联&quot;</span>
    VENDOR_DIMENSION <span class="token arrow operator">||--o{</span> INVENTORY_RECEIPT_ACCUMULATING_FACT <span class="token operator">:</span> <span class="token string">&quot;关联&quot;</span>
    DATE_RECEIVED_DIMENSION <span class="token punctuation">{</span>
        date_received_key <span class="token text string">(PK)</span>
        <span class="token arrow operator">--</span> 收货日期维度相关属性
    <span class="token punctuation">}</span>
    DATE_INSPECTED_DIMENSION <span class="token punctuation">{</span>
        date_inspected_key <span class="token text string">(PK)</span>
        <span class="token arrow operator">--</span> 检验日期维度相关属性
    <span class="token punctuation">}</span>
    DATE_BIN_PLACEMENT_DIMENSION <span class="token punctuation">{</span>
        date_bin_placement_key <span class="token text string">(PK)</span>
        <span class="token arrow operator">--</span> 货箱存放日期维度相关属性
    <span class="token punctuation">}</span>
    DATE_INITIAL_SHIPMENT_DIMENSION <span class="token punctuation">{</span>
        date_initial_shipment_key <span class="token text string">(PK)</span>
        <span class="token arrow operator">--</span> 首次发货日期维度相关属性
    <span class="token punctuation">}</span>
    DATE_LAST_SHIPMENT_DIMENSION <span class="token punctuation">{</span>
        date_last_shipment_key <span class="token text string">(PK)</span>
        <span class="token arrow operator">--</span> 末次发货日期维度相关属性
    <span class="token punctuation">}</span>
    PRODUCT_DIMENSION <span class="token punctuation">{</span>
        product_key <span class="token text string">(PK)</span>
        <span class="token arrow operator">--</span> 产品维度相关属性
    <span class="token punctuation">}</span>
    WAREHOUSE_DIMENSION <span class="token punctuation">{</span>
        warehouse_key <span class="token text string">(PK)</span>
        <span class="token arrow operator">--</span> 仓库维度相关属性
    <span class="token punctuation">}</span>
    VENDOR_DIMENSION <span class="token punctuation">{</span>
        vendor_key <span class="token text string">(PK)</span>
        <span class="token arrow operator">--</span> 供应商维度相关属性
    <span class="token punctuation">}</span>
    INVENTORY_RECEIPT_ACCUMULATING_FACT <span class="token punctuation">{</span>
        product_lot_receipt_number <span class="token text string">(DD)</span>
        date_received_key <span class="token text string">(FK)</span>
        date_inspected_key <span class="token text string">(FK)</span>
        date_bin_placement_key <span class="token text string">(FK)</span>
        date_initial_shipment_key <span class="token text string">(FK)</span>
        date_last_shipment_key <span class="token text string">(FK)</span>
        product_key <span class="token text string">(FK)</span>
        warehouse_key <span class="token text string">(FK)</span>
        vendor_key <span class="token text string">(FK)</span>
        quantity_received
        quantity_inspected
        quantity_placed_in_bin
        quantity_returned_to_vendor
        quantity_shipped_to_customer
        quantity_returned_by_customer
        quantity_returned_to_inventory
        quantity_damaged
        receipt_to_inspected_lag
        receipt_to_bin_placement_lag
        receipt_to_initial_shipment_lag
        initial_to_last_shipment_lag
    <span class="token punctuation">}</span>
</code></pre></div><p>图4-5：仓库库存累积快照</p> <p>累积快照事实表会在一批货物经历moves through由多个日期值外键所代表的标准里程碑时 standard milestones represented by multiple date-valued foreign keys，提供该批货物的最新状态信息an updated status of the lot[^4.2.3-1]。每一行累积快照事实表中的数据都会被反复‘更新’，直到<u>一批中收到的产品</u>从仓库中完全出库为止，如图4-6所示。</p> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">sequenceDiagram</span>
    <span class="token keyword">participant</span> 系统 as S
    <span class="token keyword">participant</span> 库存管理 as I
    S<span class="token arrow operator">-&gt;&gt;</span>I<span class="token operator">:</span> 产品批次收货，插入事实表行，记录收货信息
    I<span class="token arrow operator">-&gt;&gt;</span>I<span class="token operator">:</span> 产品批次检验，更新事实表行，记录检验日期及相关时间间隔
    I<span class="token arrow operator">-&gt;&gt;</span>I<span class="token operator">:</span> 产品批次放入货箱，更新事实表行，记录货箱存放日期及相关时间间隔
</code></pre></div><p>图4-6：累积快照事实行的演变</p> <p>[^4.2.3-1]: “lot” 理解为 “一批（货物）” 比较合适。</p> <h2 id="_4-3-事实表类型-fact-table-types"><a href="#_4-3-事实表类型-fact-table-types" class="header-anchor">#</a> 4.3 事实表类型 (Fact Table Types)</h2> <p>事实表<strong>仅有</strong>三种基本类型：事务型、周期快照型和累积快照型。令人惊讶的是，<strong>无论</strong>处于哪个行业，这种简单的模式都适用。这三种类型都有其作用；通常需要两个互补的事实表才能全面了解业务情况，然而这三种事实表的管理方式和更新节奏却大不相同。图4-7对它们的差异进行了比较和对比。</p> <table><thead><tr><th></th> <th>事务型</th> <th>周期快照型</th> <th>累积快照型</th></tr></thead> <tbody><tr><td>周期性</td> <td>离散的事务时间点</td> <td>在规则、可预测的时间间隔进行重复快照</td> <td>不断演变的流程/工作流的不确定时间跨度</td></tr> <tr><td>粒度</td> <td>每个事务或事务行1行</td> <td>每个快照周期加其他维度1行</td> <td>每个流程实例1行</td></tr> <tr><td>日期维度</td> <td>事务日期</td> <td>快照日期</td> <td>流程关键里程碑的多个日期</td></tr> <tr><td>事实</td> <td>事务绩效</td> <td>时间间隔内的累积绩效</td> <td>流程实例的绩效</td></tr> <tr><td>事实表稀疏度</td> <td>稀疏或密集，取决于活动情况</td> <td>可预测的密集</td> <td>稀疏或密集，取决于流程实例</td></tr> <tr><td>事实表更新</td> <td>除非纠错，否则不更新</td> <td>除非纠错，否则不更新</td> <td>每当流程活动发生时更新</td></tr></tbody></table> <p>图4-7：事实表类型比较</p> <h3 id="_4-3-1-事务事实表-transaction-fact-tables"><a href="#_4-3-1-事务事实表-transaction-fact-tables" class="header-anchor">#</a> 4.3.1 事务事实表 (Transaction Fact Tables)</h3> <p>对企业运营<u>最基本的观察视角</u>是在单个事务或事务行层面。这些事实表代表在某个瞬间发生的事件。只有当事务事件发生时，事实表中才会存在与特定客户或产品相关的行。相反，一个给定的客户或产品很可能会关联到事实表中的多行，因为理想情况下，该客户或产品会参与不止一项事务hopefully the customer or product is involved in more than one transaction。</p> <p>事务数据很容易纳入到维度框架中。原子事务数据是最自然的维度数据，它能让你极为细致地分析行为。一旦某一事务被记录到事实表中，<strong>通常</strong>你就不会再去修改它了。</p> <p>在充分阐述了事务细节的魅力之后，你可能会想，自己只需要一台强大且运行快速的服务器来处理那些繁杂的事务细枝末节，这样工作就完成了。但遗憾的是，即便拥有事务层面的数据，仍然存在一些业务问题，仅靠这些细节是难以解答的。正如前面所提到的，你不能仅仅依赖事务数据。</p> <h3 id="_4-3-2-周期快照事实表-periodic-snapshot-fact-tables"><a href="#_4-3-2-周期快照事实表-periodic-snapshot-fact-tables" class="header-anchor">#</a> 4.3.2 周期快照事实表 (Periodic Snapshot Fact Tables)</h3> <p>周期性快照用于观察企业在<strong>规律、可预测的时间间隔</strong>内的累计业务表现。与事务事实表不同，事务事实表中每发生一个事件就会载入一行数据，而周期快照则是在一天、一周或一个月结束时对业务活动“拍一张照片”（这就是“快照”这一术语的由来），然后在下一个周期结束时再拍一张，依此类推。这些周期快照会连续堆叠到事实表中。定期快照事实表往往是<strong>唯一</strong>能够轻松获取关于长期表现趋势的规律、可预测视图的地方a regular, predictable view of longitudinal performance trends。</p> <p>当交易等同于小额收入时When transactions equate to little pieces of revenue，你只需将各个交易金额相加，就可以轻松地从单个交易数据得出每日快照数据。在这种情况下，定期快照代表了一个时间段内发生的交易活动的汇总；<strong>只有</strong>出于性能方面的考虑有必要时，你才会创建这样的快照。在这种情形下，快照表的设计与其对应的事务表的设计密切相关。这些事实表共享许多维度表；总体而言，快照表通常包含的‘维度’较少。相反，经过汇总的定期快照表中的‘事实’通常比事务表中的更多，因为在该时间段内发生的‘任何’活动都可作为定期快照中的一个度量指标。</p> <p>然而，在许多企业中，事务细节并不容易汇总以呈现管理绩效指标。正如在这个库存案例研究中看到的，<strong>梳理事务极其耗时</strong>，而且就算你能够获取所需的历史数据，要解读不同类型的交易对库存水平产生的影响，其中所需的逻辑也可能会异常复杂。周期快照再次发挥作用，为管理层提供库存水平的快速、灵活视图。但愿用于这个快照模式的数据能直接取自处理这些复杂计算的业务操作系统。如果不是这样，抽取、转换和加载（ETL）系统就还必须执行这一复杂的逻辑，以便正确解读每种交易类型的影响。</p> <h3 id="_4-3-3-累积快照事实表-accumulating-snapshot-fact-tables"><a href="#_4-3-3-累积快照事实表-accumulating-snapshot-fact-tables" class="header-anchor">#</a> 4.3.3 累积快照事实表 (Accumulating Snapshot Fact Tables)</h3> <p>最后但同样重要的是，第三种事实表类型是累积快照。尽管它可能不像其他两种事实表类型那么常见，但累积快照能提供深刻的见解。累积快照代表具有明确开始和结束，以及一系列标准中间流程步骤的过程。当业务用户想要进行工作流或流程分析workflow or pipeline analysis<a href="%E6%B3%A8%E9%87%8A">^4.3.3-1</a>时，累积快照<strong>最为适用</strong>。</p> <p>累积快照<strong>总是</strong>有多个日期外键，代表可预测的主要事件或流程里程碑；<strong>有时</strong>还会有一个额外的日期列，指示快照行的最后更新时间。正如我们将在第 6 章 “订单管理” 中讨论的，这些日期都由角色扮演日期维度来处理。由于在首次加载事实行时，大多数这些日期是未知的，因此对于未定义的日期会使用默认的代理日期键。</p> <p><strong>里程碑之间的时间间隔和里程碑计数</strong></p> <p>Lags Between Milestones and Milestone Counts</p> <p>由于累积快照常常反映‘工作流或流程’的‘效率以及所耗费的时间’，事实表通常会包含代表关键里程碑之间持续时间或时间间隔的指标。</p> <ul><li>使用事务事实表来回答‘有关持续时间的问题’会<strong>很困难</strong>，因为你需要<u>关联不同行的数据</u>来计算时间间隔。</li> <li>有时，时间间隔指标仅仅是里程碑日期或时间戳之间的原始差值。在其他情况下，考虑到工作日和节假日，时间间隔的计算会变得<strong>更加复杂</strong>。</li></ul> <p>累积快照事实表<strong>有时</strong>会包含里程碑完成计数器milestone completion counters，其值为0或1。最后，累积快照<strong>通常</strong>有一个指向状态维度的外键，该外键会进行更新以反映流程的最新状态<a href="%E6%B3%A8%E9%87%8A">^4.3.3-2</a>。</p> <p><strong>累积快照更新和OLAP多维数据集</strong></p> <p>Accumulating Snapshot Updates and OLAP Cubes</p> <p>与其他类型的事实表形成鲜明对比的是，你会特意回过头来‘更新’累积快照事实表中的行数据。与定期快照不同，定期快照会‘保留’先前的快照数据，而累积快照仅仅反映的是最新的状态和指标。累积快照并<strong>不试图</strong>去处理那些不常发生的复杂场景。对于这些异常情况的分析，始终可以通过事务事实表来进行。</p> <p>值得注意的是，累积快照通常<strong>不适合</strong>用于OLAP多维数据集。因为对累积快照进行更新会导致事实数据和维度外键都发生变化，所以一旦对这些快照进行更新，立方体的很多部分都需要重新处理，除非相关事实行仅在业务流程（此处 “pipeline” 可理解为业务流程等）发生完毕后才加载<a href="%E6%B3%A8%E9%87%8A">^4.3.3-3</a>。</p> <p>“workflow or pipeline analysis”指的是工作流或业务流程分析，是对具有明确开始和结束，以及一系列标准中间流程步骤的过程进行分析。以下是一个相关例子： 在电商订单处理的业务流程中，从顾客下单开始，到订单被确认、商品从仓库发货、物流运输、顾客签收为止，这是一个有明确起止的过程。利用累积快照事实表对每个订单在各个环节的状态进行记录，比如记录订单确认时间、发货时间、物流中转节点信息、签收时间等。通过对这些记录在累积快照事实表中的数据进行分析，企业可以了解每个环节的处理时长、哪些环节容易出现延误、不同时间段订单处理效率的变化等，从而发现流程中的瓶颈和问题，以便优化流程，提高服务质量和运营效率，这就是一个典型的“workflow or pipeline analysis”。</p> <p>假设存在一个电子产品生产业务的场景，在这个业务中，产品从原材料采购到最终成品交付给客户会经历多个里程碑阶段，比如原材料入库、开始生产、生产完成、质量检测通过、产品出库等。</p> <p>可以创建一个累积快照事实表来跟踪每一批产品（可以类比之前提到的“lot”）的生产进度。对于每一批产品，在累积快照事实表中会有对应的一行数据。</p> <ol><li><strong>里程碑完成计数器</strong>：比如“质量检测通过”这个里程碑，在累积快照事实表中会有一个对应的计数器字段。如果这一批产品还没有进行质量检测或者检测未通过，那么这个计数器的值就为 0；当这批产品成功通过质量检测后，该计数器的值就更新为 1。同样地，对于“开始生产”“生产完成”等其他里程碑，也都可以设置相应的计数器，取值为 0 或 1，以此来表示该里程碑是否已经完成。</li> <li><strong>状态维度外键</strong>：设置一个状态维度表，其中包含各种可能的生产状态，如“原材料准备中”“生产中”“待检测”“已完成”等。在累积快照事实表中有一个外键字段指向状态维度表。随着这批产品在生产流程中不断推进，该外键所指向的状态维度表中的记录会相应更新，以反映当前这批产品的最新状态。例如，当产品处于生产阶段时，外键指向状态维度表中“生产中”对应的记录；当产品完成质量检测且合格后，外键就更新为指向“已完成”对应的记录。</li></ol> <p>通过这样的方式，利用里程碑完成计数器和状态维度外键，累积快照事实表能够清晰地呈现出每一批产品在生产流程中的进展和当前状态。</p> <p>以下是给出的关于累积快照事实表相关的具体表模式示例：</p> <ol><li><p><strong>累积快照事实表（Accumulating Snapshot Fact Table）</strong>
| 列名 | 数据类型 | 说明 |
| ---- | ---- | ---- |
| 主键（Primary Key） | 例如整数或唯一标识符 | 用于唯一标识表中的每一行数据，如批次ID等 |
| 里程碑完成计数器 1（Milestone Completion Counter 1） | 布尔型（或 TinyInt 0/1 表示） | 用于表示第一个里程碑是否完成，0 表示未完成，1 表示完成，比如“原材料入库完成”的标识 |
| 里程碑完成计数器 2（Milestone Completion Counter 2） | 布尔型（或 TinyInt 0/1 表示） | 用于表示第二个里程碑是否完成，0 表示未完成，1 表示完成，比如“生产完成”的标识 |
| ...（其他里程碑完成计数器） | 布尔型（或 TinyInt 0/1 表示） | 以此类推，根据实际业务流程的里程碑数量设置相应的计数器 |
| 状态维度外键（Status Dimension Foreign Key） | 与状态维度表主键对应的数据类型，如整数 | 指向状态维度表的外键，用于关联当前的业务状态 |
| 其他相关事实字段（Other Relevant Fact Fields） | 根据业务需求而定 | 例如产品数量、成本等与业务相关的事实数据 |</p></li> <li><p><strong>状态维度表（Status Dimension Table）</strong>
| 列名 | 数据类型 | 说明 |
| ---- | ---- | ---- |
| 主键（Primary Key） | 例如整数 | 唯一标识表中的每一行数据，作为状态的唯一标识 |
| 状态描述（Status Description） | 字符串类型，如 VARCHAR | 对状态的具体描述，如“进行中”“已完成”“暂停”等 |</p></li></ol> <p>以上表模式是基于文本中提到的累积快照事实表包含里程碑完成计数器以及指向状态维度表的外键的信息构建的，实际应用中可根据具体业务场景进行调整和扩展。</p> <p>假设一家汽车制造企业使用OLAP立方体来分析汽车生产流程的相关数据，并且采用了累积快照事实表来跟踪每辆汽车的生产进度。</p> <p>在这个场景中，汽车的生产流程（pipeline）包括零部件采购、组装、质量检测、喷漆等多个阶段。累积快照事实表中记录了每辆汽车在各个阶段的状态以及相关的生产指标（如生产时间、成本等），同时还有指向不同维度表（如零部件供应商维度表、生产车间维度表等）的外键。</p> <ol><li><strong>正常情况</strong>：一辆汽车开始生产，在累积快照事实表中创建了一行数据，记录了该汽车的初始状态（如零部件采购中）以及相关的初始指标。随着生产的进行，当汽车进入组装阶段时，需要更新累积快照事实表中这辆汽车对应的行数据，将状态改为“组装中”，同时可能还会更新一些与组装相关的事实数据（如已使用的工时等）。<u>由于这个更新操作，不仅事实数据（工时等）发生了变化，而且如果组装阶段涉及到新的维度信息（比如不同的组装车间对应不同的维度记录），那么维度外键也可能会改变。</u>此时，OLAP立方体中与这辆汽车生产相关的部分数据就需要重新处理，因为立方体是基于原来的快照数据构建的，现在数据发生了变化，为了保证分析结果的准确性，就需要对相关部分进行重新计算和处理。</li> <li><strong>特殊情况（避免重新处理）</strong>：如果规定相关事实行仅在汽车生产流程完全结束后才加载到累积快照事实表中。例如，当一辆汽车完成了零部件采购、组装、质量检测、喷漆等所有生产环节后，<u>一次性将这辆汽车完整的生产数据（包括最终状态、所有阶段的指标、对应的维度信息等）加载到累积快照事实表中。这样在整个生产过程中，就不需要对累积快照事实表进行多次更新</u>，也就不会出现因为更新导致事实数据和维度外键变化，进而使得OLAP立方体很多部分需要重新处理的情况。</li></ol> <p>通过这个例子可以更清楚地理解为什么对累积快照的更新会影响OLAP立方体，以及在什么情况下可以避免这种影响。</p> <h3 id="_4-3-4-互补的事实表类型-complementary-fact-table-types"><a href="#_4-3-4-互补的事实表类型-complementary-fact-table-types" class="header-anchor">#</a> 4.3.4 互补的事实表类型 (Complementary Fact Table Types)</h3> <p>有时，累积快照和周期快照会协同工作。例如，在构建每月快照时，可以通过将每天事务的影响添加到滚动的累积快照中，同时在周期快照中存储 36 个月的历史数据。理想情况下，当到达一个月的最后一天时，累积快照直接成为时间序列中新的常规月份数据，第二天再开始一个新的累积快照。</p> <p>‘事务’和‘快照’是维度设计的两个重要方面（Transactions and snapshots are the yin and yang of dimensional designs.事务表和快照表是维度设计中的阴阳两面。）。</p> <ul><li>配套使用的事务事实表和快照事实表共同为企业运营提供了一个完整的视角。</li> <li>之所以两者都不可或缺，是因为通常没有简单的方法能将这两种截然不同的视角整合到单个事实表中。</li> <li>尽管事务表和快照表之间存在一定的理论数据冗余，但作为数据仓库和商业智能（DW/BI）的数据发布者，你不会排斥这种冗余，因为你的任务是发布数据，以便企业组织能够有效地对其进行分析。这些不同类型的事实表从不同角度讲述着同一个故事。</li></ul> <p>令人惊奇的是，对于本书中所描述的用例来说，这三种类型的事实表竟然涵盖了<strong>所有</strong>所需的事实表类型。</p> <h2 id="_4-4-价值链整合-value-chain-integration"><a href="#_4-4-价值链整合-value-chain-integration" class="header-anchor">#</a> 4.4 价值链整合 (Value Chain Integration)</h2> <p>现在我们已经完成了三种库存模型的设计，让我们回顾一下之前关于零售商价值链的讨论。企业和信息技术（IT）组织通常都对价值链整合感兴趣。企业管理层需要审视企业的各个流程，以更好地评估绩效。例如，许多数据仓库/商业智能（DW/BI）项目致力于从端到端的角度更好地理解客户行为。显然，这需要能够在不同流程（如报价、订单、发票、付款和客户服务）中‘一致’地查看客户信息。同样，组织希望在不同流程中分析其产品、员工、学生、供应商等等。</p> <p>信息技术（IT）经理们认识到，要实现数据仓库和商业智能所承诺的价值，就需要进行数据整合。许多人认为，管理企业组织的信息资产是他们应尽的受托责任。他们明白，如果任由孤立、非集成的数据库大量存在，他们就是没有履行好自己的职责。除了满足业务需求之外，信息技术部门自身也能从数据整合中受益，因为这能让企业组织更好地利用稀缺资源，并通过使用‘可复用的组件来提高效率。</p> <p>幸运的是，通常对整合最感兴趣的高级管理人员也拥有必要的‘组织影响力’和‘经济实力’来推动整合的实现。如果他们不重视整合，那么你将面临更严峻的组织挑战，更直白地说，你的整合项目可能会失败。推动整个价值链的整合并获得组织共识不应该只是DW/BI经理的唯一责任。高级管理层的政治支持很重要，这让DW/BI经理摆脱了困境，将责任放在了高级领导层的肩上，这才是正确的做法。</p> <p>在第3章和第4章中，我们对零售商价值链的几个流程的数据进行了建模。尽管每个流程的数据由不同维度模式中的不同事实表表示，但这些模型‘共享’几个常见的业务维度：日期、产品和商店。我们在图4-8中逻辑地展示了这种维度共享。使用共享的通用维度对于设计可集成的维度模型绝对<strong>至关重要</strong>。</p> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">graph</span> TD<span class="token punctuation">;</span>
    A<span class="token text string">[事务事实 - 零售销售]</span> <span class="token arrow operator">--&gt;</span> B<span class="token text string">[促销维度]</span>
    A <span class="token arrow operator">--&gt;</span> C<span class="token text string">[商店维度]</span>
    A <span class="token arrow operator">--&gt;</span> D<span class="token text string">[日期维度]</span>
    A <span class="token arrow operator">--&gt;</span> E<span class="token text string">[产品维度]</span>
    F<span class="token text string">[零售库存 - 快照事实]</span> <span class="token arrow operator">--&gt;</span> D
    F <span class="token arrow operator">--&gt;</span> E
    F <span class="token arrow operator">--&gt;</span> C
    G<span class="token text string">[仓库库存 - 事务事实]</span> <span class="token arrow operator">--&gt;</span> D
    G <span class="token arrow operator">--&gt;</span> E
    G <span class="token arrow operator">--&gt;</span> C
    G <span class="token arrow operator">--&gt;</span> H<span class="token text string">[仓库维度]</span>
</code></pre></div><p>图4-8：业务流程之间共享维度</p> <h2 id="_4-5-企业数据仓库总线架构-enterprise-data-warehouse-bus-architecture"><a href="#_4-5-企业数据仓库总线架构-enterprise-data-warehouse-bus-architecture" class="header-anchor">#</a> 4.5 企业数据仓库总线架构 (Enterprise Data Warehouse Bus Architecture)</h2> <p>显然，试图一蹴而就地构建企业的数据仓库和商业智能（DW/BI）系统building the enterprise’s DW/BI system in one galactic efort，任务太过艰巨，令人望而却步，然而，若将其拆分成一个个孤立的部分来构建，又会违背确保数据一致性这一<strong>最重要</strong>的目标。为了数据仓库和商业智能系统能够取得长期的成功，你需要采用<u>一种有规划的、渐进式的方法</u>来构建企业的数据仓库。我们所倡导的方法是企业数据仓库总线架构。</p> <h3 id="_4-5-1-理解总线架构-understanding-the-bus-architecture"><a href="#_4-5-1-理解总线架构-understanding-the-bus-architecture" class="header-anchor">#</a> 4.5.1 理解总线架构 (Understanding the Bus Architecture)</h3> <p>与普遍看法相反，“bus”（总线）一词并非“business”（业务）的缩写，它是一个源于电力行业的术语，如今在计算机行业也有应用。总线是一种通用结构，所有设备都连接到它，并从中获取动力。计算机中的总线是一种标准接口规范，它能让你接入磁盘驱动器、DVD或其他各种专用卡或设备。由于计算机的总线标准，这些外围设备即便由不同厂商在不同时间生产，也能协同工作并正常共存。</p> <p>注意：通过为数据仓库和商业智能（DW/BI）环境定义一个标准的总线接口，不同的团队可以在不同的时间实现各自独立的维度模型。如果各个独立的业务流程主题领域都遵循该标准，那么它们就能够相互‘衔接’，并有效地‘共存’。</p> <p>回顾图4-1中的价值链示意图，你可以想象许多业务流程接入企业数据仓库总线的情景，如图4-9所示。最终，组织价值链中的所有流程会创建一系列维度模型，这些模型共享一组全面的通用、一致性维度。</p> <div class="language-mermaid extra-class"><pre class="language-mermaid"><code><span class="token keyword">graph</span> TD<span class="token punctuation">;</span>
    A<span class="token text string">[采购订单]</span> <span class="token arrow operator">--&gt;</span> B<span class="token text string">[日期]</span>
    A <span class="token arrow operator">--&gt;</span> C<span class="token text string">[产品]</span>
    A <span class="token arrow operator">--&gt;</span> D<span class="token text string">[商店]</span>
    A <span class="token arrow operator">--&gt;</span> E<span class="token text string">[促销]</span>
    A <span class="token arrow operator">--&gt;</span> F<span class="token text string">[仓库]</span>
    A <span class="token arrow operator">--&gt;</span> G<span class="token text string">[供应商]</span>
    A <span class="token arrow operator">--&gt;</span> H<span class="token text string">[托运人]</span>
    I<span class="token text string">[商店库存]</span> <span class="token arrow operator">--&gt;</span> B
    I <span class="token arrow operator">--&gt;</span> C
    I <span class="token arrow operator">--&gt;</span> D
    J<span class="token text string">[商店销售]</span> <span class="token arrow operator">--&gt;</span> B
    J <span class="token arrow operator">--&gt;</span> C
    J <span class="token arrow operator">--&gt;</span> D
    J <span class="token arrow operator">--&gt;</span> E
</code></pre></div><p>图4-9：具有共享维度的企业数据仓库总线</p> <p>企业数据仓库总线架构为‘分解’企业数据仓库/商业智能规划任务提供了一种合理的方法。</p> <ul><li>一套‘标准化’的维度和事实在整个企业内具有统一的解释，这建立了数据架构框架。</li> <li>然后，你可以着手实施以流程为中心的独立维度模型，每个实施过程都要严格遵循该架构。</li> <li>当各个独立的维度模型完成后，它们就像拼图的各个部分一样‘组合’在一起。</li> <li>到了某个阶段，会有足够多的维度模型，‘实现’集成的企业数据仓库/商业智能环境的愿景。</li></ul> <p>总线架构独立于技术和数据库平台。只要基于一致性维度和事实进行设计，各种基于关系型和OLAP的维度模型<strong>都可以</strong>成为企业数据仓库总线的一部分。数据仓库/商业智能系统不可避免地由具有不同操作系统和数据库管理系统的独立机器组成。如果设计合理，它们会共享一致性维度和事实的通用架构，从而能够整合为一个整体。</p> <h3 id="_4-5-2-企业数据仓库总线矩阵-enterprise-data-warehouse-bus-matrix"><a href="#_4-5-2-企业数据仓库总线矩阵-enterprise-data-warehouse-bus-matrix" class="header-anchor">#</a> 4.5.2 企业数据仓库总线矩阵 (Enterprise Data Warehouse Bus Matrix)</h3> <p>我们<strong>建议</strong>使用企业数据仓库总线矩阵来记录和阐释总线架构，如图4-10所示。其他人对总线矩阵有不同的称呼，如一致性矩阵或事件矩阵，但这些只是20世纪90年代首次提出的这个基本Kimball概念的代名词。</p> <p>以表格形式进行梳理时，组织的业务流程会被表示为矩阵的行。务必牢记，此时你要确定的是‘业务流程’，而非组织的‘业务部门’。这些矩阵行可转化为维度模型，用来呈现组织的主要活动和事件，而这些活动和事件往往可以从其运营源头识别出来。当着手开展一个数据仓库与商业智能（DW/BI）开发项目时，应从单个业务流程矩阵行<strong>开始</strong>，因为这样能将因过度雄心勃勃的实施计划而带来的风险降至最低。大多数实施风险都源于承担了过多的抽取、转换和加载（ETL）系统的设计与开发工作。专注于单个流程的结果（这些结果通常由单个底层源系统捕获），可以降低ETL开发风险。</p> <p>矩阵的列代表企业范围内使用的通用维度。在填充矩阵前，创建一个核心维度列表有助于评估某个维度是否应与特定业务流程相关联。总线矩阵的行数和列数因组织而异。对<strong>许多</strong>组织而言，矩阵近似正方形，大约有25到50行，列数也大致相同。在其他行业，如保险行业，列数<strong>往往</strong>多于行数。</p> <p>确定核心流程和维度后，对矩阵单元格进行阴影标记或打“X”，以表明哪些列与每一行相关。这样，你能立刻看清组织的一致性维度与关键业务流程之间的逻辑关系和相互作用。</p> <p><strong>矩阵的多种用途</strong></p> <p>Multiple Matrix Uses</p> <p>创建企业数据仓库总线矩阵是数据仓库/商业智能（DW/BI）实施过程中最重要的成果之一。它是一种多功能的资源，具有多种用途，包括架构规划、数据库设计、数据治理协调、项目估算以及组织沟通等方面。</p> <p>虽然排列矩阵的行和列相对简单，但企业总线矩阵却定义了整个DW/BI系统的数据架构。无论数据库或技术偏好如何，该矩阵都能提供一个‘全局视角’。</p> <p>矩阵的列直接满足了‘主数据管理’和‘数据集成’的需求。由于参与多个维度模型的‘核心维度’是由承担数据治理职责的人员定义，并由数据仓库和商业智能（DW/BI）团队构建的，所以你可以设想它们在不同流程中的应用，而不是基于单个流程的需求凭空设计，更糟糕的是，基于单个部门的需求<a href="%E5%8E%9F%E6%96%87">^4.5.2-1</a>。共享维度就像强效的集成粘合剂，使企业能够实现跨流程的深入分析。</p> <p>每个以业务流程为核心的实施项目business process-centric implementation project都在‘逐步’构建整体架构。多个开发团队可以独立、异步地处理矩阵的各个组成部分，并且可以确信这些部分最终能够‘组合’在一起。项目经理只需查看流程行，就能一眼看清每个维度模型所涉及的维度。在评估项目工作量时，这种视角<strong>非常有帮助</strong>。专注于维度较少的业务流程的项目，通常所需的工作量也较少，尤其是在那些涉及敏感业务的维度已经准备就绪的情况下。</p> <p>该矩阵使您能够在数据治理团队和数据仓库 / 商业智能（DW/BI）团队内部以及团队之间进行有效的‘沟通’。</p> <ul><li>更为重要的是，您可以利用该矩阵在整个组织内进行向上和向外的沟通。该矩阵是一个简洁的可交付成果，能够直观地传达总体规划。</li> <li>IT 管理层需要理解这一视角，以便在各项目团队之间进行协调，并抵制组织内快速部署更多部门级解决方案的冲动。IT 管理层还必须确保分布式的 DW/BI 开发团队致力于遵循总线架构。</li> <li>业务管理层也需要理解这一整体规划；您希望他们了解按业务流程逐步推进 DW/BI 系统部署的阶段安排。此外，该矩阵还阐明了从业务部门中确定专家担任通用维度数据治理负责人的重要性。</li> <li>该矩阵能够有效地与开发人员、架构师、建模师、项目经理以及高级 IT 和业务管理人员进行沟通，这充分体现了它简洁性的优势。</li></ul> <p><strong>机会/利益相关者矩阵</strong>
Opportunity/Stakeholder Matrix</p> <p>你可以草拟一个不同的矩阵，沿用相同的业务流程行，但将维度列替换为业务职能，比如商品采购、市场营销、门店运营以及财务等。根据每个职能部门的需求，对矩阵单元格进行标注（涂色），以表明哪些业务职能部门对哪些业务流程（以及项目）感兴趣，如图4-11所示的机会/利益相关者矩阵变体所示。该矩阵还能确定，在以流程为中心的某一行被列为项目之后，需要邀请哪些团队参与详细需求分析、维度建模以及商业智能（BI）应用规范制定等工作。</p> <p><strong>常见的总线矩阵错误</strong>
Common Bus Matrix Mistakes</p> <p>在构建企业数据仓库总线矩阵时，存在一些常见的错误，需要尽力避免。这些错误可能会破坏矩阵作为规划和沟通工具的有效性，甚至可能对整个数据仓库/商业智能（DW/BI）项目的成功产生负面影响。</p> <ol><li><p><strong>业务流程定义不当</strong>：其中一个主要错误是对业务流程的定义不准确或过于宽泛。</p> <ol><li>业务流程应该是清晰、可识别的组织活动，具有明确的输入、输出和一系列连贯的步骤。如果业务流程定义不明确，那么矩阵的行就会缺乏意义，并且难以确定哪些维度与它们相关。</li> <li>例如，将“客户管理”定义为一个业务流程过于笼统，因为它可能涵盖了客户获取、客户服务、客户细分等多个不同的活动。<strong>更好的做法</strong>是将这些子活动定义为单独的业务流程，以便更精确地映射维度和理解业务需求。</li></ol></li> <li><p><strong>维度选择错误</strong>：选择错误的维度或遗漏重要维度也是一个常见问题。</p> <ol><li>维度应该是业务中稳定且有意义的属性，用于描述和分析业务流程。有时，团队可能会专注于技术或运营细节，而忽略了对业务用户至关重要的业务维度。</li> <li>例如，在零售业务中，忽略了“季节”维度，这可能会影响对销售数据的分析，因为销售业绩通常会受到季节因素的显著影响。此外，未能识别共享维度，导致在不同的业务流程中重复定义相似的维度，会破坏数据的一致性和整合性。</li></ol></li> <li><p><strong>缺乏数据治理参与</strong>：在构建总线矩阵时，如果没有数据治理团队的充分参与，可能会导致严重的问题。</p> <ol><li>数据治理团队负责定义和维护数据标准、数据质量和数据所有权。如果他们没有参与到矩阵的创建过程中，那么矩阵中定义的维度和业务流程可能无法反映数据治理的要求。</li> <li>例如，数据治理团队可能会规定某些维度的数据来源和更新频率，如果在矩阵中没有考虑这些因素，那么在实施数据仓库时可能会出现数据不一致和质量问题。</li></ol></li> <li><p><strong>忽视业务用户需求</strong>：另一个常见错误是在构建矩阵时忽视了业务用户的需求。</p> <ol><li>总线矩阵应该是一个满足业务用户分析和决策需求的工具。如果在构建过程中没有与业务用户充分沟通，那么矩阵可能无法提供他们所需的信息。</li> <li>例如，业务用户可能需要对特定业务流程进行详细的时间序列分析，但矩阵中没有包含相应的时间维度或事实。因此，在构建矩阵时，与业务用户进行密切的合作和沟通，确保矩阵能够满足他们的实际需求是非常重要的。</li></ol></li> <li><p><strong>矩阵更新不及时</strong>：</p> <ol><li>企业的业务环境是不断变化的，新的业务流程可能会出现，现有的业务流程可能会发生改变，业务需求也可能会随着时间而演变。如果总线矩阵不能及时更新以反映这些变化，那么它将逐渐失去其作为规划和沟通工具的价值。</li> <li>例如，如果企业推出了新的产品线，那么矩阵中应该添加相应的维度和业务流程，以确保能够对新产品的销售和运营进行有效的分析。</li></ol></li></ol> <p>通过避免这些常见的错误，可以构建一个更准确、更有用的企业数据仓库总线矩阵，为数据仓库/商业智能项目的成功奠定坚实的基础。这个矩阵将成为一个有效的规划工具，帮助组织协调不同项目团队的工作，确保数据的一致性和整合性，并满足业务用户的分析和决策需求。</p> <p><strong>将现有模型适配到总线矩阵中</strong>
Retrofitting Existing Models to a Bus Matrix
在许多情况下，组织已经拥有一些现有的数据模型，可能是部门级的数据集市、遗留的数据库系统，或者是早期尝试构建的数据仓库模型。当决定采用企业数据仓库总线架构时，面临的<strong>挑战</strong>之一就是如何将这些现有的模型适配到新的总线矩阵中。</p> <ol><li><p><strong>评估现有模型</strong>：首先要对现有的数据模型进行全面的评估。</p> <ol><li>这包括理解每个模型所涵盖的业务流程、使用的维度和事实，以及数据的来源和质量。分析现有模型与业务流程的对应关系，确定哪些业务流程已经在模型中得到了体现，哪些还需要补充。</li> <li>例如，某个部门级的数据集市可能只关注销售业务流程，而忽略了库存管理和采购等其他重要流程。同时，检查维度的定义和一致性，看看是否存在相同维度在不同模型中有不同定义的情况。</li></ol></li> <li><p><strong>映射到总线矩阵</strong>：根据对现有模型的评估，将其映射到企业数据仓库总线矩阵中。</p> <ol><li>确定每个现有模型对应的业务流程行和维度列。对于已经存在于总线矩阵中的业务流程和维度，检查现有模型中的数据是否与总线矩阵的定义一致。如果不一致，需要进行调整和协调。</li> <li>例如，如果现有模型中“产品”维度的定义与总线矩阵中“产品”维度的定义存在差异，需要决定以哪个为准，并对数据进行相应的转换。对于现有模型中存在但总线矩阵中未包含的维度或业务流程，需要考虑是否将其纳入总线矩阵，以及如何与其他部分进行整合。</li></ol></li> <li><p><strong>数据整合和转换</strong>：在将现有模型映射到总线矩阵后，通常需要进行数据整合和转换工作。</p> <ol><li>这可能涉及从不同的数据源提取数据，清洗和转换数据以符合总线矩阵的标准和规范，然后将数据加载到新的数据仓库或数据集市中。</li> <li>例如，如果现有模型中的数据存储在不同的数据库系统中，并且数据格式和编码方式不一致，需要进行数据清洗和转换，以确保数据的一致性和准确性。同时，可能还需要处理数据的粒度问题，确保数据在不同模型之间的粒度匹配。</li></ol></li> <li><p><strong>建立数据治理机制</strong>：为了确保现有模型适配到总线矩阵后的长期稳定性和数据质量，建立有效的数据治理机制是非常重要的。</p> <ol><li>数据治理机制应该包括数据标准的制定和维护、数据质量的监控和改进、数据所有权的明确和管理等方面。</li> <li>例如，明确每个维度和事实的数据所有者，由他们负责数据的准确性和完整性。同时，建立数据质量监控指标和流程，定期对数据进行检查和评估，及时发现和解决数据质量问题。</li></ol></li> <li><p><strong>逐步迁移和测试</strong>：在进行现有模型适配时，建议采用逐步迁移的方式，而不是一次性将所有数据和模型都迁移到新的总线矩阵架构中。</p> <ol><li>这样可以降低风险，便于及时发现和解决问题。在每个阶段，都要进行充分的测试，包括功能测试、性能测试和数据质量测试等。确保新的模型和数据能够满足业务用户的需求，并且与其他部分的系统和数据能够正常交互。</li></ol></li></ol> <p>将现有模型适配到总线矩阵中是一个复杂的过程，需要全面的评估、细致的映射、有效的数据整合和转换、完善的数据治理机制以及逐步的迁移和测试。通过合理的规划和执行，可以成功地将现有模型纳入到企业数据仓库总线架构中，实现数据的一致性和整合性，为企业的决策提供更有力的支持。</p> <p>As core dimensions participating in multiple dimensional models are</p> <ul><li>defined by folks with data governance responsibilities and</li> <li>built by the DW/BI team,</li> <li>you can envision <u>their use across processes</u> rather than <u>designing in a vacuum based on the needs of a single process</u>, or even worse, <u>designing in a vacuum based on the needs of a single department</u>.</li></ul> <h2 id="_4-6-一致性维度-conformed-dimensions"><a href="#_4-6-一致性维度-conformed-dimensions" class="header-anchor">#</a> 4.6 一致性维度 (Conformed Dimensions)</h2> <p>既然你已经了解了企业总线架构的重要性，那我们就进一步探究一下作为总线基石的标准化一致性维度the standardized conformed dimensions，因为这些维度在各个业务流程事实表中是‘共享’的。</p> <ul><li>一致性维度还有许多其他别名：通用维度、主维度、参考维度以及共享维度。</li> <li>一致性维度应该在抽取、转换和加载（ETL）系统中只构建一次，然后在整个企业数据仓库和商业智能（DW/BI）环境中进行逻辑或物理复制。</li> <li>在构建一致性维度时，数据仓库和商业智能（DW/BI）开发团队承诺使用这些维度是极其重要的。这是一项对企业数据仓库和商业智能系统正常运行至关重要的政策决定；企业的首席信息官（CIO）应该<strong>强制要求</strong>使用这些维度。</li></ul> <h3 id="_4-6-1-跨事实表钻取-drilling-across-fact-tables"><a href="#_4-6-1-跨事实表钻取-drilling-across-fact-tables" class="header-anchor">#</a> 4.6.1 跨事实表钻取 (Drilling Across Fact Tables)</h3> <p>除了具有一致性和可复用性之外，一致性维度还能让你在一份单独的报告中整合来自不同业务流程的绩效衡量指标，如图4-12所示。你可以使用多遍SQL分别查询每个维度模型，然后根据一个共同的维度属性（例如图4-12中的产品名称）对查询结果进行外连接。完全外连接可确保所有行都包含在合并后的报告中，即使这些行仅出现在某一组查询结果中。如果维度表的属性值是相同的，那么这种通常被称为“跨流程钻取”的关联操作就很简单直接。</p> <p>许多商业智能（BI）产品和平台都支持跨流程钻取功能。不同产品在实现方式上存在差异，主要体现在是在<u>临时表、应用服务器还是报表</u>中对查询结果进行连接操作。各供应商也会使用不同的术语来描述这一技术，包括多遍查询、多选择查询、多事实查询或拼接查询等。由于跨流程钻取查询会将来自不同事实表的指标汇总在一起，因此通常在分别返回符合要求的结果后，任何跨事实的计算都必须在商业智能应用程序中进行。</p> <p>一致性维度有几种不同的类型，具体将在以下章节中进行介绍。</p> <h3 id="_4-6-2-完全一致的一致性维度-identical-conformed-dimensions"><a href="#_4-6-2-完全一致的一致性维度-identical-conformed-dimensions" class="header-anchor">#</a> 4.6.2 完全一致的一致性维度 (Identical Conformed Dimensions)</h3> <p>在最基本的层面上，一致性维度意味着在与它们连接的每一个可能的事实表中，其含义都是相同的。</p> <ul><li>连接到销售事实表的日期维度表，与连接到库存事实表的日期维度表是完全一样的。</li> <li>完全相同的一致性维度具有一致的维度键、属性列名称、属性定义以及属性值（这会转化为一致的报表标签和分组）。</li> <li>如果一个维度中某个属性被称为“Month”（月份），而在另一个维度中被称为“Month Name”（月份名称），那么这些属性就不具有一致性；同样，如果一个维度中某个属性值是“July”，而在另一个维度中是“JULY”，那它们也不具有一致性。</li> <li>在两个维度模型中，完全相同的一致性维度在数据库中<strong>可能</strong>是同一个物理表。然而，考虑到数据仓库和商业智能（DW/BI）系统技术环境通常具有的复杂性，涉及多个数据库平台，<strong>更常见的情况</strong>是在抽取、转换和加载（ETL）系统中只构建一次维度，然后将其同步复制到每个维度模型中。无论哪种情况，两个维度模型中的一致性日期维度都具有相同的行数、相同的键值、相同的属性标签、相同的属性数据定义以及相同的属性值。属性列名称在各个维度之间应该有唯一的标识。</li></ul> <p><strong>大多数</strong>一致性维度都是尽可能在最细粒度的层面上自然定义的。产品维度的粒度会是单个产品；日期维度的粒度会是单个日期。</p> <ul><li>然而，有时处于相同粒度级别的维度并不能完全一致。例如，在‘库存分析’中可能会用到一些产品和店铺的属性，但这些属性并不适用于分析‘零售销售’数据。</li> <li>如果键和公共列是相同的，那么这些维度表仍然是一致的，不过库存模式所使用的‘补充属性’the supplemental attributes并不一致。从实际情况来看，使用这些附加属性add-on attributes是无法实现‘跨流程钻取’的<a href="%E6%B3%A8%E9%87%8A">^4.6.2-1</a>。</li></ul> <p>在一家连锁超市的业务分析场景中，存在产品维度和日期维度。</p> <p>产品维度：</p> <ul><li>按最细粒度定义时，产品维度的粒度是单个产品。比如一瓶特定品牌、规格、批次的洗发水，这就是一个具体的产品粒度实例。</li> <li>在分析零售销售数据时，记录的是每一瓶洗发水的销售情况，包括销售时间、地点、价格等。然而，在库存分析中，除了基本的产品信息外，还需要一些补充属性，如该洗发水在仓库中的存储位置、保质期剩余时长等。这些存储位置和保质期剩余时长就是库存分析特有的补充属性，它们不适用于零售销售数据分析。</li> <li>虽然在产品维度表中，用于关联事实表的键（如产品ID）以及一些公共列（如产品名称、产品类别等）在零售销售数据和库存分析中是相同的，但这些补充属性在两种分析场景中不一致，无法实现跨流程钻取。例如，不能通过存储位置这个补充属性从库存分析直接关联到零售销售数据的分析中。</li></ul> <p>日期维度：</p> <ul><li>按最细粒度定义，日期维度的粒度是单个日期。比如2025年1月1日，这是一个明确的日期粒度实例。在零售销售数据中，基于每一天记录洗发水的销售数量和金额等信息。在库存分析中，同样以每一天为粒度记录库存的变动情况，如进货、出货、库存盘点等。在这种情况下，日期维度的键（日期值本身）和公共列（如年、月、日等划分信息）在两个业务流程中是一致的，属于符合一致性维度的要求。</li></ul> <h3 id="_4-6-3-具有属性子集的收缩汇总一致性维度-shrunken-rollup-conformed-dimension-with-attribute-subset"><a href="#_4-6-3-具有属性子集的收缩汇总一致性维度-shrunken-rollup-conformed-dimension-with-attribute-subset" class="header-anchor">#</a> 4.6.3 具有属性子集的收缩汇总一致性维度 (Shrunken Rollup Conformed Dimension with Attribute Subset)</h3> <p>当‘维度’包含<u>来自更细粒度维度的属性子集</u>时，‘这些维度’也具有‘一致性’。当<u>事实表捕获的绩效指标的粒度级别</u>高于<u>原子基础维度</u>时，就需要‘收缩’的汇总维度。</p> <ul><li>如果你除了‘每日库存快照’之外还有‘每周库存快照’，就会出现这种情况。</li> <li>在其他情况下，事实数据是由另一个业务流程在更高的粒度级别上‘生成’的。例如，零售销售流程在原子产品级别‘捕获’数据，而‘预测’则在品牌级别生成数据。你<strong>无法</strong>在这两个业务流程模式中共享单个产品维度表，因为粒度不同。</li> <li>如果品牌表的属性是原子产品表属性的严格子集，那么产品维度和品牌维度仍然是一致的。详细维度表和汇总维度表中都有的共同属性，比如品牌和类别的描述，在两个表中应该有相同的标签、定义和取值，如图4-13所示。不过，详细维度表和汇总维度表的主键是相互独立的<a href="%E4%BE%8B%E5%AD%90">^4.6.3-1</a>。</li></ul> <p>注意：如果收缩的汇总维度的属性是原子基础维度属性的严格子集，那么该收缩的汇总维度就与原子基础维度是一致的。</p> <p>在下面表格中，品牌维度表的属性（品牌、品牌类别描述）是原子产品维度表属性的严格子集，且品牌这一共同属性在两个表中的标签、定义和取值是相同的，同时两个表的主键（产品ID和品牌ID）是相互独立的，符合文本中关于收缩维度一致性的描述：</p> <p><strong>原子产品维度表（详细级别）</strong></p> <table><thead><tr><th>产品ID（主键）</th> <th>产品名称</th> <th>品牌</th> <th>产品类别</th> <th>规格</th> <th>其他产品特定属性</th></tr></thead> <tbody><tr><td>1</td> <td>某品牌手机A型号</td> <td>品牌X</td> <td>通讯设备</td> <td>8GB + 128GB</td> <td>屏幕尺寸、摄像头像素等</td></tr> <tr><td>2</td> <td>某品牌电脑B型号</td> <td>品牌Y</td> <td>计算机</td> <td>16GB + 512GB</td> <td>处理器型号、显卡类型等</td></tr> <tr><td>3</td> <td>某品牌洗发水C型号</td> <td>品牌Z</td> <td>个人护理</td> <td>500ml</td> <td>香味类型、适用发质等</td></tr> <tr><td>4</td> <td>某品牌牙膏D型号</td> <td>品牌W</td> <td>个人护理</td> <td>180g</td> <td>含氟量、口味等</td></tr></tbody></table> <p><strong>品牌维度表（缩减汇总级别）</strong></p> <table><thead><tr><th>品牌ID（主键）</th> <th>品牌</th> <th>品牌类别描述</th></tr></thead> <tbody><tr><td>1</td> <td>品牌X</td> <td>专注于通讯设备的品牌，技术先进</td></tr> <tr><td>2</td> <td>品牌Y</td> <td>以高性能计算机产品著称的品牌</td></tr> <tr><td>3</td> <td>品牌Z</td> <td>知名的个人护理品牌，产品线丰富</td></tr> <tr><td>4</td> <td>品牌W</td> <td>在口腔护理领域有良好口碑的品牌</td></tr></tbody></table> <h3 id="_4-6-4-具有行子集的收缩一致性维度-shrunken-conformed-dimension-with-row-subset"><a href="#_4-6-4-具有行子集的收缩一致性维度-shrunken-conformed-dimension-with-row-subset" class="header-anchor">#</a> 4.6.4 具有行子集的收缩一致性维度 (Shrunken Conformed Dimension with Row Subset)</h3> <p>另一种一致性维度子集的情况是，当两个维度处于相同的详细程度，但其中一个维度仅代表行的一个子集。</p> <ul><li>例如，一个公司级的产品维度包含了横跨多个不同业务线的全系列产品的相关行数据，如图4-14所示。</li> <li>各个独立业务部门的分析师可能只想查看公司级维度中属于他们业务的那部分产品行数据子集。通过使用行子集，他们就不会被公司的整个产品集所困扰。当然，与这个子集维度相连接的事实表也必须限定在相同的产品子集范围内。如果用户在访问一个由完整产品集构成的事实表时，尝试使用一个收缩的子集维度，他们可能会得到意外的查询结果，因为这会违反参照完整性。你需要意识到维度行子集可能会给用户带来困惑或导致错误的潜在风险<a href="%E4%BE%8B%E5%AD%90">^4.6.4-1</a>例子。</li> <li>在第10章“金融服务”中讨论超类型和子类型维度时，我们将进一步阐述维度子集的相关内容。</li></ul> <p>一致性的‘日期维度’和‘月份维度’是行维度子集和列维度子集的一个独特示例。显然，由于汇总粒度的不同，你不能简单地将同一个日期维度表用于每日事实表和每月事实表。然而，月份维度可能由月末的每日日期表行组成，并且要排除所有在月度粒度下不适用的列，比如工作日/周末指示器、本周结束日期、节假日指示器、年内的日期序号等等。<strong>有时</strong>，在每日日期维度上设置一个月末指示器，以便于创建这个月份维度表。</p> <p>以某多元化公司（包含电子产品业务线和日用品业务线）为例，展示企业产品维度、维度子集以及相关事实表的情况：</p> <p><strong>企业产品维度表（完整）</strong></p> <table><thead><tr><th>产品ID</th> <th>产品名称</th> <th>业务线</th> <th>产品类别</th> <th>产品规格</th> <th>其他属性</th></tr></thead> <tbody><tr><td>1</td> <td>某品牌手机</td> <td>电子产品</td> <td>通讯设备</td> <td>8GB + 128GB</td> <td>特性描述等</td></tr> <tr><td>2</td> <td>某品牌电脑</td> <td>电子产品</td> <td>计算机</td> <td>16GB + 512GB</td> <td>特性描述等</td></tr> <tr><td>3</td> <td>某品牌洗发水</td> <td>日用品</td> <td>个人护理</td> <td>500ml</td> <td>特性描述等</td></tr> <tr><td>4</td> <td>某品牌牙膏</td> <td>日用品</td> <td>个人护理</td> <td>180g</td> <td>特性描述等</td></tr></tbody></table> <p><strong>电子产品业务线维度子集表</strong></p> <table><thead><tr><th>产品ID</th> <th>产品名称</th> <th>业务线</th> <th>产品类别</th> <th>产品规格</th> <th>其他属性</th></tr></thead> <tbody><tr><td>1</td> <td>某品牌手机</td> <td>电子产品</td> <td>通讯设备</td> <td>8GB + 128GB</td> <td>特性描述等</td></tr> <tr><td>2</td> <td>某品牌电脑</td> <td>电子产品</td> <td>计算机</td> <td>16GB + 512GB</td> <td>特性描述等</td></tr></tbody></table> <p><strong>电子产品业务线事实表（与维度子集对应）</strong></p> <table><thead><tr><th>产品ID</th> <th>销售日期</th> <th>销售数量</th> <th>销售额</th> <th>其他销售相关属性</th></tr></thead> <tbody><tr><td>1</td> <td>2025-01-01</td> <td>10</td> <td>50000</td> <td>销售门店等</td></tr> <tr><td>2</td> <td>2025-01-02</td> <td>5</td> <td>30000</td> <td>销售门店等</td></tr></tbody></table> <p><strong>日用品业务线维度子集表</strong></p> <table><thead><tr><th>产品ID</th> <th>产品名称</th> <th>业务线</th> <th>产品类别</th> <th>产品规格</th> <th>其他属性</th></tr></thead> <tbody><tr><td>3</td> <td>某品牌洗发水</td> <td>日用品</td> <td>个人护理</td> <td>500ml</td> <td>特性描述等</td></tr> <tr><td>4</td> <td>某品牌牙膏</td> <td>日用品</td> <td>个人护理</td> <td>180g</td> <td>特性描述等</td></tr></tbody></table> <p><strong>日用品业务线事实表（与维度子集对应）</strong></p> <table><thead><tr><th>产品ID</th> <th>销售日期</th> <th>销售数量</th> <th>销售额</th> <th>其他销售相关属性</th></tr></thead> <tbody><tr><td>3</td> <td>2025-01-03</td> <td>20</td> <td>1000</td> <td>销售门店等</td></tr> <tr><td>4</td> <td>2025-01-04</td> <td>15</td> <td>800</td> <td>销售门店等</td></tr></tbody></table> <p>如果用户错误地使用电子产品业务线维度子集表去查询包含所有产品（电子产品和日用品）的完整事实表，就可能会出现数据关联错误等意外的查询结果，因为此时维度子集和事实表的产品范围不匹配。</p> <h3 id="_4-6-5-总线矩阵上的收缩一致性维度-shrunken-conformed-dimensions-on-the-bus-matrix"><a href="#_4-6-5-总线矩阵上的收缩一致性维度-shrunken-conformed-dimensions-on-the-bus-matrix" class="header-anchor">#</a> 4.6.5 总线矩阵上的收缩一致性维度 (Shrunken Conformed Dimensions on the Bus Matrix)</h3> <p>总线矩阵确定了在不同业务流程中通用维度的复用情况。通常，矩阵中带阴影的单元格表示原子维度与特定的业务流程相关联。当涉及到‘收缩的汇总维度’或‘维度子集’时，你需要‘强化’reinforce它们与原子维度的一致性。因此，你<strong>不会想要</strong>在总线矩阵上创建一个新的、不相关的列。相反，有两种可行的方法来在矩阵中表示收缩的维度，如图4-15所示：</p> <ul><li>标记出<u>对应原子维度的单元格</u>，然后在该单元格内以文字形式记录汇总或行子集的粒度信息。</li> <li>‘细分’维度列以表明常见的‘汇总粒度’或‘子集粒度’，例如，如果业务流程同时在日和月这两种粒度上收集数据，那就标明日和月。</li></ul> <h3 id="_4-6-6-有限的一致性-limited-conformity"><a href="#_4-6-6-有限的一致性-limited-conformity" class="header-anchor">#</a> 4.6.6 有限的一致性 (Limited Conformity)</h3> <p>既然我们已经强调了一致性维度的重要性，接下来我们将讨论这样一种情况：对于一个组织而言，建立一致性维度可能<u>既不现实，也没有必要</u>。</p> <ul><li>如果一家企业集团拥有涉足众多不同行业的子公司，那么尝试整合这些子公司的数据可能意义不大</li> <li>。如果每个业务线都有其独特的客户群体和独特的产品，并且没有跨业务线进行交叉销售的意愿，那么尝试构建企业架构可能并无意义，因为这样做很可能不会带来太多被认可的商业价值。</li> <li>对于一个从理论上来说有意构建企业数据仓库/商业智能（DW/BI）系统的组织而言，是否愿意为产品、客户或其他核心维度寻求一个共同的定义，是一项重要的试金石。如果一个组织不愿意就共同定义达成一致，那么该组织就不应该尝试构建企业数据仓库/商业智能环境。在这种情况下，为每个子公司分别构建独立、自给自足的数据仓库可能会更好。但如果有人在没有考虑到这一逻辑的情况下要求了解“企业绩效”，那就不要抱怨了。</li></ul> <p>尽管各组织可能会发现，将不同业务线的数据整合起来并非易事，但在一定程度上进行整合通常是最终目标。与其举手投降，宣称这根本不可能做到，不如朝着实现数据一致性的方向迈出第一步。或许存在一些能在不同业务线之间实现一致的属性。即便这些属性仅仅是所有业务共有的产品描述、产品类别以及业务线属性，这种基于最低公分母的方法仍然是朝着正确方向迈出的一步。在推进工作之前，你<strong>无需</strong>让所有人都对与某个维度相关的所有方面达成一致意见。</p> <h3 id="_4-6-7-数据治理与数据管理的重要性-importance-of-data-governance-and-stewardship"><a href="#_4-6-7-数据治理与数据管理的重要性-importance-of-data-governance-and-stewardship" class="header-anchor">#</a> 4.6.7 数据治理与数据管理的重要性 (Importance of Data Governance and Stewardship)</h3> <p>我们已经强调了一致性维度的重要性，但我们也需要认识到一个<strong>关键挑战</strong>：在维度属性名称和内容上达成企业共识（以及处理内容变化，我们将在第5章“采购”中讨论这一点）。在许多组织中，‘业务规则’和‘数据定义’传统上是由各个部门自行制定的。这种普遍存在的数据治理和管控缺失所导致的后果，就是无处不在的部门数据孤岛，这些孤岛延续着相似但又略有差异的 “事实版本”。如果想要从混乱中建立秩序，业务和IT管理层就需要认识到解决这一不足的重要性；如果管理层不愿意推动变革，项目就<strong>永远无法实现</strong>其目标。</p> <p>一旦高级领导层认识到数据治理的问题和机遇，就需要确定相关资源来推动这项工作。IT部门常常想要带头推动。他们对组织中孤立的项目不断重新创建数据感到沮丧，这些项目消耗了无数的IT和外部资源，却提供了不一致的解决方案，最终只会大幅增加组织数据架构的复杂性。虽然IT部门可以促进一致性维度的定义，但即使只是临时任务，仅靠IT部门也很少能成功推动。IT部门缺乏让事情顺利进行的组织权威。</p> <p><strong>业务驱动的治理</strong></p> <p>为了提高业务接受度，来自业务部门的主题专家需要领导这项倡议。领导一个跨组织的治理项目并非易事。由业务领导层确定的数据治理人员应具备以下特点：</p> <ul><li>受到组织的尊重</li> <li>对企业的运营有广泛的了解</li> <li>有能力平衡组织需求和部门要求</li> <li>有足够的影响力和权威挑战现状并执行政策</li> <li>具备很强的沟通能力</li> <li>具备政治敏锐的谈判和建立共识的技能</li></ul> <p>显然，并非每个人都适合这项工作！通常被选中领导治理项目的人都是备受重视、被广泛需要的。这需要具备合适的技能、经验和信心，来协调不同的业务观点，推动通用参考数据的设计，并做出必要的组织妥协。多年来，有人批评一致性维度太难实现。确实，要让企业不同部门的人就通用的属性名称、定义和值达成一致是很困难的，但这正是统一、集成数据的关键所在。如果每个人都坚持使用自己的标签和业务规则，那就不可能实现建立单一事实版本的承诺。数据治理项目对于推动文化转变至关重要，即从每个部门都掌控自己的数据和分析的典型孤岛环境，转变为整个组织共享和利用信息的环境。</p> <p><strong>治理目标</strong></p> <p>数据治理职能的<strong>关键目标之一</strong>，是就数据定义、标签和域值达成一致，以便每个人都使用相同的 “语言”。否则，可能会出现同样的词描述不同的事物、不同的词描述相同的事物，以及同样的值具有不同含义的情况。建立通用的主数据<strong>通常</strong>是一个充满政治敏感性的问题；面临的挑战是文化和组织层面的，而非技术层面的。定义主描述一致性维度的基础需要付出努力。但一旦达成共识，后续的数据仓库/商业智能工作就可以利用这些成果，既确保了一致性，又缩短了实施交付周期。</p> <p>除了解决数据定义和内容问题，数据治理职能还为数据质量、准确性以及数据安全性和访问控制制定政策并明确职责。</p> <p>从历史上看，数据仓库/商业智能团队制定一致性维度的 “规则”，并在ETL系统中管理数据清洗和集成映射；运营系统专注于准确捕获绩效指标，但往往很少努力确保通用参考数据的一致性。企业资源规划（ERP）系统承诺填补这一空白，但许多组织仍然依赖针对特定需求的最佳点解决方案。最近，运营主数据管理（MDM）解决方案满足了在捕获事务的源头集中管理主数据的需求。尽管技术可以促进数据集成，但并不能解决根本问题。无论采用何种技术方法，强大的数据治理职能都是实现信息一致性的必要前提。</p> <h3 id="_4-6-8-一致性维度与敏捷运动-conformed-dimensions-and-the-agile-movement"><a href="#_4-6-8-一致性维度与敏捷运动-conformed-dimensions-and-the-agile-movement" class="header-anchor">#</a> 4.6.8 一致性维度与敏捷运动 (Conformed Dimensions and the Agile Movement)</h3> <p>一些人抱怨说，尽管他们希望在数据仓库/商业智能环境中提供并共享定义一致的主一致性维度，但 “这根本不可行”。他们解释说，如果可以的话他们会这么做，但由于高级管理层专注于使用敏捷开发技术，所以 “不可能” 花时间就一致性维度达成组织共识。但你可以反驳这种观点，即一致性维度有助于实现敏捷的数据仓库/商业智能开发以及敏捷决策。</p> <p>一致性维度允许维度表只需构建和维护一次，而无需在每个开发周期中重新创建略有不同的版本。跨项目重用一致性维度，是实现更敏捷的数据仓库/商业智能开发的关键。随着你逐步完善主一致性维度的组合，开发速度会越来越快。由于开发人员可以重用现有的一致性维度，新业务流程数据源的上市时间也会缩短。最终，新的ETL开发几乎可以只专注于提供更多的事实表，因为相关的维度表已经准备就绪。</p> <p>定义一致性维度需要组织达成共识，并致力于数据管理。但你不必让每个人都对每个维度表中的每个属性达成一致。至少，你应该确定一组在企业范围内有意义的属性。这些常用的描述性特征构成了一致性属性的起始集，实现了跨钻取集成。即使只有一个属性，比如企业产品类别，也可以作为集成工作的可行起点。随着时间的推移，你可以从这个最小化的起点开始，通过添加属性逐步扩展。这些维度可以在架构敏捷冲刺中处理。当一系列冲刺交付成果组合起来能提供足够的价值时，就可以向业务用户发布。</p> <p>如果你因为压力而急于交付成果，而没有专注于一致性维度，部门分析数据孤岛可能会出现不一致的分类和标签。更麻烦的是，由于标签相似，数据集可能看起来可以进行比较和集成，但底层的业务规则可能略有不同。业务用户会浪费大量时间来协调和解决这些数据不一致的问题，这对他们成为敏捷决策者的能力产生了负面影响。</p> <p>那些要求采用敏捷系统开发实践的高级IT经理，如果他们既关注企业的长期开发效率，又关注长期决策的有效性，就应该与业务部门的同行一起，对开发一致的一致性维度施加更大的组织压力。</p> <h2 id="_4-7-一致性事实-conformed-facts"><a href="#_4-7-一致性事实-conformed-facts" class="header-anchor">#</a> 4.7 一致性事实 (Conformed Facts)</h2> <p>到目前为止，我们讨论了<u>建立一致性维度</u>以<u>将各个维度模型联系在一起</u>的核心任务。这在数据架构工作中占比超过95%。剩下5%的工作则是确立一致性的事实定义。</p> <p>收入、利润、标准价格和成本、质量和客户满意度指标，以及其他关键绩效指标（KPI）等，这些事实也必须保持一致。</p> <ul><li>如果同一事实存在于多个维度模型中，那么<strong>只有</strong>当它们的基本定义和计算公式完全相同时，才能被视为同一事物。</li> <li>如果它们的标签相同，那么在不同的维度模型中，其定义<strong>必须</strong>基于相同的维度背景，并且使用相同的度量单位。</li> <li>例如，若多个业务流程都报告收入，只有当这些不同来源的收入指标在财务定义上完全一致时，才能够进行相加和对比。如果定义存在差异，那么必须为这些收入事实赋予不同的标签，以作区分。</li></ul> <p><strong>注意</strong> 在数据命名规范方面，你必须严格遵守规则。如果无法使某个事实完全一致，就<strong>应该</strong>为不同的解释赋予不同的名称，以免业务用户在计算过程中将这些不兼容的事实混淆在一起。</p> <p>有时，同一事实在不同的事实表中会有不同的‘自然度量单位’。</p> <ul><li>例如，在零售价值链中，产品在仓库阶段可能最好以装运箱数来计量，而在商店中则以扫描的单品数量来计量。即使所有维度因素都已被正确考虑在内，要在一份跨钻取报告中同时使用这两种不兼容的度量单位仍然非常困难。</li> <li>通常解决这类问题的方法是，让用户参考产品维度表中隐藏的换算系数，并期望用户能够找到该系数并正确使用。但这种方法既增加了用户的操作负担，又容易出错，并不理想。<strong>正确的做法</strong>是，同时使用两种度量单位来记录该事实，这样报告就能轻松地沿着价值链获取可对比的事实数据。第6章 “订单管理” 将进一步讨论多种度量单位的问题。</li></ul> <h2 id="_4-8-总结-summary"><a href="#_4-8-总结-summary" class="header-anchor">#</a> 4.8 总结 (Summary)</h2> <p>在本章中，我们针对库存的三种互补视角开发了维度模型。周期性快照适用于长期持续补货的库存场景；累积快照适用于有明确起止的有限库存流转场景；并且，大多数库存分析需要事务模式来补充这些快照模型。</p> <p>我们介绍了企业数据仓库总线架构和矩阵的关键概念。价值链中的每个业务流程，由一个主要源系统支持，会转化为总线矩阵中的一行，并最终形成一个维度模型。矩阵中的行共享大量标准化的一致性维度。如果想要构建一个由一组集成维度模型组成的数据仓库/商业智能系统，开发并遵循企业总线架构是绝对必要的。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blankornotes/assets/js/app.9dfec706.js" defer></script><script src="/blankornotes/assets/js/2.a76d4e78.js" defer></script><script src="/blankornotes/assets/js/1.2ec8c7d7.js" defer></script><script src="/blankornotes/assets/js/27.181728ca.js" defer></script>
  </body>
</html>
